<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FinTrack Pro - AI Finance</title>
    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
            --primary: #4f46e5;
            --success: #10b981;
            --danger: #f43f5e;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100vh;
            margin: 0;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .page-transition {
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(226, 232, 240, 0.8);
            padding-bottom: calc(0.75rem + var(--safe-area-bottom));
        }

        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        input:focus { outline: none; }
        select { -webkit-appearance: none; appearance: none; }
        
        .active-tab { color: var(--primary); transform: translateY(-2px); }
        .tab-icon { transition: all 0.2s ease; }
        * {
          touch-action: manipulation;
        }
        
        button, a, input, select {
          touch-action: manipulation;
          pointer-events: auto;
        }
        
        body {
          overscroll-behavior: none;
        }

    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.10.3?external=react,react-dom",
        "@google/genai": "https://esm.sh/@google/genai@1.3.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip } from 'recharts';
        import { GoogleGenAI } from "@google/genai";

        // --- Constants & Types ---
        const STORAGE_KEY = 'fintrack_pro_v4_unified';
        const INITIAL_BUDGET = 10000000;

        const CATEGORIES = [
            { id: '1', label: 'Ä‚n uá»‘ng', icon: 'ðŸ”', color: '#f43f5e', type: 'expense' },
            { id: '2', label: 'Di chuyá»ƒn', icon: 'ðŸš—', color: '#f59e0b', type: 'expense' },
            { id: '3', label: 'Mua sáº¯m', icon: 'ðŸ›ï¸', color: '#ec4899', type: 'expense' },
            { id: '4', label: 'Giáº£i trÃ­', icon: 'ðŸŽ®', color: '#8b5cf6', type: 'expense' },
            { id: '5', label: 'Sá»©c khá»e', icon: 'ðŸ¥', color: '#0ea5e9', type: 'expense' },
            { id: '6', label: 'LÆ°Æ¡ng', icon: 'ðŸ’µ', color: '#10b981', type: 'income' },
            { id: '7', label: 'ThÆ°á»Ÿng', icon: 'ðŸŽ', color: '#3b82f6', type: 'income' },
            { id: '8', label: 'KhÃ¡c', icon: 'âœ¨', color: '#64748b', type: 'expense' },
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [transactions, setTransactions] = useState([]);
            const [budget, setBudget] = useState(INITIAL_BUDGET);
            const [aiAdvice, setAiAdvice] = useState('ChÃ o báº¡n! TÃ´i lÃ  Gemini. HÃ£y ghi láº¡i chi tiÃªu Ä‘á»ƒ tÃ´i tÆ° váº¥n tÃ i chÃ­nh cho báº¡n nhÃ©.');
            const [isAiLoading, setIsAiLoading] = useState(false);

            // Form State
            const [type, setType] = useState('expense');
            const [amountInput, setAmountInput] = useState('');
            const [selectedCat, setSelectedCat] = useState(CATEGORIES[0].label);
            const [note, setNote] = useState('');

            // --- Database Logic (LocalStorage) ---
            useEffect(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        setTransactions(parsed.transactions || []);
                        setBudget(parsed.budget || INITIAL_BUDGET);
                    } catch (e) { console.error("Restore failed", e); }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({ transactions, budget }));
            }, [transactions, budget]);

            // --- Stats Calculation ---
            const stats = useMemo(() => {
                const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
                const expense = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
                const progress = budget > 0 ? Math.min((expense / budget) * 100, 100) : 0;
                return { income, expense, balance: income - expense, progress };
            }, [transactions, budget]);

            const chartData = useMemo(() => {
                const groups = {};
                transactions.filter(t => t.type === 'expense').forEach(t => {
                    groups[t.category] = (groups[t.category] || 0) + t.amount;
                });
                return Object.entries(groups).map(([name, value]) => ({
                    name, value, color: CATEGORIES.find(c => c.label === name)?.color || '#94a3b8'
                })).sort((a, b) => b.value - a.value);
            }, [transactions]);

            // --- Handlers ---
            const handleSave = (e) => {
                e.preventDefault();
                const rawAmount = parseInt(amountInput.replace(/\D/g, ''));
                if (!rawAmount) return;

                const newTx = {
                    id: Date.now().toString(),
                    amount: rawAmount,
                    type,
                    category: selectedCat,
                    note: note.trim(),
                    date: new Date().toLocaleDateString('vi-VN'),
                    timestamp: Date.now()
                };

                setTransactions([newTx, ...transactions]);
                setAmountInput('');
                setNote('');
                setActiveTab('history');
            };

            const fetchAiAdvice = async () => {
                if (isAiLoading) return;
                setIsAiLoading(true);
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const recentContext = transactions.slice(0, 10).map(t => `${t.category}: ${t.amount}Ä‘`).join(', ');
                    const prompt = `Báº¡n lÃ  chuyÃªn gia tÃ i chÃ­nh. Dá»¯ liá»‡u: Chi ${stats.expense}Ä‘/${budget}Ä‘ ngÃ¢n sÃ¡ch. Gáº§n Ä‘Ã¢y: ${recentContext}. ÄÆ°a ra 1 lá»i khuyÃªn ngáº¯n gá»n, hÃ i hÆ°á»›c, thá»±c táº¿ báº±ng tiáº¿ng Viá»‡t (dÆ°á»›i 25 tá»«).`;
                    
                    const result = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: prompt
                    });
                    setAiAdvice(result.text || "Tiáº¿t kiá»‡m lÃ  quá»‘c sÃ¡ch!");
                } catch (err) {
                    setAiAdvice("HÃ£y tiáº¿p tá»¥c ghi chÃ©p Ä‘á»ƒ tÃ´i hiá»ƒu thÃ³i quen cá»§a báº¡n hÆ¡n.");
                } finally {
                    setIsAiLoading(false);
                }
            };

            const handleDelete = (id) => {
                setTransactions(transactions.filter(t => t.id !== id));
            };

            // --- Render Components ---
            return React.createElement('div', { className: 'flex flex-col h-screen max-w-md mx-auto bg-slate-50 relative' },
                // Header
                React.createElement('div', { className: 'bg-indigo-600 p-6 pt-12 pb-10 text-white rounded-b-[45px] shadow-2xl shrink-0 z-10' },
                    React.createElement('div', { className: 'flex justify-between items-start' },
                        React.createElement('div', null,
                            React.createElement('p', { className: 'text-[11px] font-bold uppercase opacity-60 tracking-[2px]' }, 'Sá»‘ dÆ° tá»•ng'),
                            React.createElement('h1', { className: 'text-4xl font-black mt-1 tracking-tight' }, stats.balance.toLocaleString() + 'Ä‘')
                        ),
                        React.createElement('div', { className: 'bg-white/10 p-3 rounded-2xl backdrop-blur-md' },
                            React.createElement('i', { className: 'fas fa-wallet text-xl' })
                        )
                    ),
                    React.createElement('div', { className: 'mt-8 grid grid-cols-2 gap-4' },
                        React.createElement('div', { className: 'bg-white/10 p-4 rounded-2xl' },
                            React.createElement('p', { className: 'text-[10px] font-black uppercase opacity-60 mb-1' }, 'Thu nháº­p'),
                            React.createElement('p', { className: 'text-base font-bold text-emerald-300' }, '+' + stats.income.toLocaleString())
                        ),
                        React.createElement('div', { className: 'bg-white/10 p-4 rounded-2xl' },
                            React.createElement('p', { className: 'text-[10px] font-black uppercase opacity-60 mb-1' }, 'Chi tiÃªu'),
                            React.createElement('p', { className: 'text-base font-bold text-rose-300' }, '-' + stats.expense.toLocaleString())
                        )
                    ),
                    React.createElement('div', { className: 'mt-6 px-1' },
                        React.createElement('div', { className: 'flex justify-between text-[10px] font-black mb-2 uppercase tracking-widest' },
                            React.createElement('span', { className: 'opacity-70' }, 'NgÃ¢n sÃ¡ch thÃ¡ng'),
                            React.createElement('span', null, Math.round(stats.progress) + '%')
                        ),
                        React.createElement('div', { className: 'h-2 w-full bg-white/20 rounded-full overflow-hidden' },
                            React.createElement('div', { 
                                className: `h-full transition-all duration-1000 ease-out ${stats.progress > 90 ? 'bg-rose-400' : 'bg-emerald-400'}`, 
                                style: { width: stats.progress + '%' } 
                            })
                        )
                    )
                ),

                // Main Content
                React.createElement('div', { className: 'flex-1 overflow-y-auto no-scrollbar p-6 pb-32' },
                    activeTab === 'home' && React.createElement('div', { className: 'page-transition space-y-6' },
                        React.createElement('div', { className: 'flex bg-slate-200 p-1.5 rounded-2xl shadow-inner' },
                            React.createElement('button', { 
                                onClick: () => { setType('expense'); setSelectedCat(CATEGORIES.find(c => c.type === 'expense').label); },
                                className: `flex-1 py-2.5 rounded-xl text-[11px] font-black uppercase transition-all ${type === 'expense' ? 'bg-white text-rose-500 shadow-md' : 'text-slate-500'}`
                            }, 'Chi tiÃªu'),
                            React.createElement('button', { 
                                onClick: () => { setType('income'); setSelectedCat(CATEGORIES.find(c => c.type === 'income').label); },
                                className: `flex-1 py-2.5 rounded-xl text-[11px] font-black uppercase transition-all ${type === 'income' ? 'bg-white text-emerald-500 shadow-md' : 'text-slate-500'}`
                            }, 'Thu nháº­p')
                        ),
                        React.createElement('form', { onSubmit: handleSave, className: 'space-y-4' },
                            React.createElement('div', { className: 'bg-white p-8 rounded-[35px] card-shadow border border-slate-100' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: '0',
                                    value: amountInput,
                                    onChange: e => setAmountInput(e.target.value.replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ",")),
                                    className: 'w-full text-5xl font-black text-center text-slate-800'
                                }),
                                React.createElement('div', { className: 'grid grid-cols-2 gap-4 mt-8' },
                                    React.createElement('div', { className: 'relative' },
                                        React.createElement('select', { 
                                            value: selectedCat, 
                                            onChange: e => setSelectedCat(e.target.value),
                                            className: 'w-full p-4 bg-slate-50 rounded-2xl text-xs font-bold border-none outline-none'
                                        }, CATEGORIES.filter(c => c.type === type).map(c => React.createElement('option', { key: c.id, value: c.label }, c.icon + ' ' + c.label))),
                                        React.createElement('i', { className: 'fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-[10px] text-slate-300' })
                                    ),
                                    React.createElement('input', {
                                        placeholder: 'Ghi chÃº...',
                                        value: note,
                                        onChange: e => setNote(e.target.value),
                                        className: 'p-4 bg-slate-50 rounded-2xl text-xs font-bold border-none outline-none'
                                    })
                                )
                            ),
                            React.createElement('button', { type: 'submit', className: 'w-full bg-slate-900 text-white py-5 rounded-[25px] font-black uppercase text-[11px] tracking-[3px] shadow-xl active:scale-95 transition-all' }, 'LÆ°u giao dá»‹ch')
                        ),
                        React.createElement('div', { className: 'bg-indigo-900 p-6 rounded-[35px] text-white shadow-2xl relative overflow-hidden' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                                React.createElement('span', { className: 'text-[10px] font-black uppercase tracking-widest text-indigo-300 flex items-center gap-2' }, 
                                    React.createElement('i', { className: 'fas fa-robot' }), 'Trá»£ lÃ½ AI Gemini'
                                ),
                                React.createElement('button', { 
                                    onClick: fetchAiAdvice, 
                                    disabled: isAiLoading, 
                                    className: 'text-[10px] bg-indigo-500/40 hover:bg-indigo-500/60 px-4 py-2 rounded-full font-black' 
                                }, isAiLoading ? '...' : 'TÆ° váº¥n')
                            ),
                            React.createElement('p', { className: 'text-sm font-medium leading-relaxed italic' }, '"' + aiAdvice + '"')
                        )
                    ),

                    activeTab === 'charts' && React.createElement('div', { className: 'page-transition space-y-6' },
                        React.createElement('div', { className: 'h-72 bg-white rounded-[35px] p-6 card-shadow border border-slate-50 relative' },
                            React.createElement('h3', { className: 'absolute top-6 left-8 text-[10px] font-black text-slate-400 uppercase tracking-[2px]' }, 'PhÃ¢n bá»• chi tiÃªu'),
                            chartData.length > 0 ? React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                                React.createElement(PieChart, null,
                                    React.createElement(Pie, { data: chartData, cx: '50%', cy: '50%', innerRadius: 65, outerRadius: 90, paddingAngle: 8, dataKey: 'value', stroke: 'none' },
                                        chartData.map((entry, index) => React.createElement(Cell, { key: index, fill: entry.color }))
                                    ),
                                    React.createElement(Tooltip, { contentStyle: { borderRadius: '20px', border: 'none', boxShadow: '0 10px 20px rgba(0,0,0,0.1)' } })
                                )
                            ) : React.createElement('div', { className: 'h-full flex flex-col items-center justify-center text-slate-300' }, 
                                React.createElement('i', { className: 'fas fa-chart-area text-4xl mb-2 opacity-10' }),
                                React.createElement('p', { className: 'text-[10px] font-black uppercase tracking-widest' }, 'ChÆ°a cÃ³ dá»¯ liá»‡u')
                            )
                        ),
                        React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                            chartData.map((item, i) => React.createElement('div', { key: i, className: 'bg-white p-4 rounded-2xl border border-slate-100 flex items-center gap-4 card-shadow' },
                                React.createElement('div', { className: 'w-3 h-3 rounded-full shrink-0', style: { backgroundColor: item.color } }),
                                React.createElement('div', { className: 'overflow-hidden' },
                                    React.createElement('p', { className: 'text-[10px] font-black text-slate-400 uppercase truncate' }, item.name),
                                    React.createElement('p', { className: 'text-sm font-black' }, item.value.toLocaleString() + 'Ä‘')
                                )
                            ))
                        )
                    ),

                    activeTab === 'history' && React.createElement('div', { className: 'page-transition space-y-4' },
                        transactions.length === 0 ? React.createElement('div', { className: 'text-center py-20 text-slate-300' },
                            React.createElement('i', { className: 'fas fa-history text-5xl mb-4 opacity-10' }),
                            React.createElement('p', { className: 'font-black text-[10px] uppercase tracking-[3px]' }, 'Trá»‘ng')
                        ) :
                        transactions.map(t => React.createElement('div', { key: t.id, className: 'bg-white p-5 rounded-3xl flex justify-between items-center border border-slate-50 shadow-sm mb-3 transition-transform active:scale-[0.98]' },
                            React.createElement('div', { className: 'flex items-center gap-4' },
                                React.createElement('div', { className: 'w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-2xl' }, CATEGORIES.find(c => c.label === t.category)?.icon || 'ðŸ’°'),
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-sm font-black text-slate-800' }, t.category),
                                    React.createElement('p', { className: 'text-[10px] text-slate-400 font-bold' }, t.note || t.date)
                                )
                            ),
                            React.createElement('div', { className: 'text-right' },
                                React.createElement('p', { className: `text-sm font-black ${t.type === 'income' ? 'text-emerald-500' : 'text-rose-500'}` }, (t.type === 'income' ? '+' : '-') + t.amount.toLocaleString() + 'Ä‘'),
                                React.createElement('button', { onClick: () => handleDelete(t.id), className: 'text-[9px] font-black text-slate-300 uppercase hover:text-rose-400' }, 'XÃ³a')
                            )
                        ))
                    ),

                    activeTab === 'settings' && React.createElement('div', { className: 'page-transition space-y-8' },
                        React.createElement('div', { className: 'bg-white p-8 rounded-[35px] card-shadow text-center border border-slate-100' },
                            React.createElement('p', { className: 'text-[11px] font-black text-slate-400 uppercase mb-4 tracking-[3px]' }, 'Háº¡n má»©c chi tiÃªu thÃ¡ng'),
                            React.createElement('input', {
                                type: 'number',
                                value: budget,
                                onChange: e => setBudget(parseInt(e.target.value) || 0),
                                className: 'text-4xl font-black text-indigo-600 text-center w-full bg-transparent border-b-2 border-indigo-50 focus:border-indigo-400 transition-colors pb-2'
                            })
                        ),
                        React.createElement('div', { className: 'space-y-3' },
                            React.createElement('button', { 
                                onClick: () => {
                                    const data = JSON.stringify({ transactions, budget }, null, 2);
                                    const blob = new Blob([data], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'fintrack_backup.json';
                                    a.click();
                                },
                                className: 'w-full py-5 bg-indigo-50 text-indigo-600 font-black rounded-3xl text-[11px] uppercase tracking-widest' 
                            }, React.createElement('i', { className: 'fas fa-download mr-2' }), 'Xuáº¥t dá»¯ liá»‡u'),
                            React.createElement('button', { 
                                onClick: () => { if(confirm('XÃ³a sáº¡ch?')) { setTransactions([]); localStorage.clear(); location.reload(); } },
                                className: 'w-full py-5 bg-rose-50 text-rose-500 font-black rounded-3xl text-[11px] uppercase tracking-widest' 
                            }, React.createElement('i', { className: 'fas fa-trash-alt mr-2' }), 'XÃ³a sáº¡ch bá»™ nhá»›')
                        ),
                        React.createElement('div', { className: 'text-center pt-8' },
                            React.createElement('p', { className: 'text-[10px] font-black text-slate-300 uppercase tracking-widest' }, 'FinTrack Pro AI v4.0.0'),
                            React.createElement('p', { className: 'text-[9px] font-bold text-slate-200' }, 'Local Database & Gemini AI Protected')
                        )
                    )
                ),

                // Navigation
                React.createElement('nav', { className: 'fixed bottom-0 left-0 right-0 glass-nav flex justify-around items-center px-6 py-4 z-50 max-w-md mx-auto shadow-[0_-10px_30px_rgba(0,0,0,0.05)]' },
                    React.createElement('button', { onClick: () => setActiveTab('home'), className: `flex flex-col items-center gap-1 flex-1 ${activeTab === 'home' ? 'active-tab' : 'text-slate-400'}` },
                        React.createElement('i', { className: 'fas fa-plus-circle text-2xl tab-icon' }),
                        React.createElement('span', { className: 'text-[9px] font-black uppercase' }, 'Má»›i')
                    ),
                    React.createElement('button', { onClick: () => setActiveTab('charts'), className: `flex flex-col items-center gap-1 flex-1 ${activeTab === 'charts' ? 'active-tab' : 'text-slate-400'}` },
                        React.createElement('i', { className: 'fas fa-chart-pie text-2xl tab-icon' }),
                        React.createElement('span', { className: 'text-[9px] font-black uppercase' }, 'Äá»“ thá»‹')
                    ),
                    React.createElement('button', { onClick: () => setActiveTab('history'), className: `flex flex-col items-center gap-1 flex-1 ${activeTab === 'history' ? 'active-tab' : 'text-slate-400'}` },
                        React.createElement('i', { className: 'fas fa-history text-2xl tab-icon' }),
                        React.createElement('span', { className: 'text-[9px] font-black uppercase' }, 'Lá»‹ch sá»­')
                    ),
                    React.createElement('button', { onClick: () => setActiveTab('settings'), className: `flex flex-col items-center gap-1 flex-1 ${activeTab === 'settings' ? 'active-tab' : 'text-slate-400'}` },
                        React.createElement('i', { className: 'fas fa-sliders-h text-2xl tab-icon' }),
                        React.createElement('span', { className: 'text-[9px] font-black uppercase' }, 'CÃ i Ä‘áº·t')
                    )
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
